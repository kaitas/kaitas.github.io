---
layout: post
title: "「ヨコハマメリー」／「AceSpeeder2」の新型インタフェース"
date: 2006-03-12 00:05:53 +0100
author: aki
---

## 積年の謎が映画化

実はハマっ子なんですが、さらにいうと馬車道～伊勢佐木町～日の出町あたりは中学ぐらいから通ってたのでけっこう詳しかったりします。

そんな頃、時々見かけたり声をかけられたりしていた
白塗りドレスの小さなおばあさん。
記憶の中にずっと「謎の存在」として残っていたのですが、
近頃映画になったそうです。

 http://www.tokyo-np.co.jp/00/thatu/20060130/mng_____thatu___000.shtml
 http://www.cinematopics.com/cinema/works/output2.php?oid=6669


てっきりファンタジーランドか妖怪ランドの住人だと思っていたのですが…。

 メリーさんのドキュメンタリー映画、4月8日に封切決定
 http://news.mixi.jp/view_news.pl?id=11783&media_id=7


### 「ヨコハマメリー」公式サイト
[http://hitohito.jp/](http://hitohito.jp/)


----
## 悩みどころ

AceSpeeder2の新型インタフェースを検討するために実験に篭り始めて約24時間経過…。

新しいカメラの特性はだいぶつかんできた。
90FPSモードも試してみたが、どういうわけかちらつきが激しくて、今一歩、安定性にかける。
ちらつきを除去するフィルタを書いてもいいが、これはシャッタスピードを落とすのと同じかそれ以下の意味しか持たないし。

とりあえずナカタニさんから更新版のAS2が届いたので(といってもFolderShareを使っているので、配信は一瞬)、試してみる。
通信プロトコル問題も片付いて、遊べるようになった。

今のバージョンに名前をつけると
「念力スノーボードUI」という感じだろうか。
左前(もしくは右前)に構えて、片手をぐいっと前に出す。
手をパーに開くとアクセル、グーにするとブレーキ。
すばやくこれをやると、ブーストになる。

これはこれでかっこいいのだが、幾つか問題を発見する。

### 【画角から外れる】

　ふだん等身大触覚インタフェースなどをやっているので、こういう問題はあまり起きなかったりする。フレームの外に出るなら、フォースフィードバックの壁を作ってアシストできるからだ(実験的に壁や床をつくらなかったことがあるが、これではゲームがうまく遊べなくなる)。
　画像認識UIの最大の弱点というのが、この「力覚なし問題」で、これは剣神ドラゴンクエストのようなタンジブルなブツを用意するか、箱などで制約をつくってあげれば防ぐことはできる。
　しかしなんといっても根本的な問題はカメラセットアップだ。画角が50度程度のWebCamで、人間の腕の自由度である1-1.5mを確保しようとすると、約2m程の視距離をとる必要がある。これ自体は問題ではないのだが、仮に1.5mの横幅をとると1ピクセルの解像度が4mm程度、これでは動作が大味になっただけで、「細かい動き」を入力できない、検出精度も悪くなる。何より照明も大きなものを用意する必要が出てくるので、都合が悪い。

### 【解決案いくつか】

とりあえず、いろいろ試行錯誤しながら、新しいUIポジションを思いついた。

### コードネーム「丹田法」

正面に構えて、両手を拳にしてどちらかを前にするとその方向に向く。
ちょうど乗馬のインタフェースに似ている。
2本の操縦桿を握っているようなイメージだろうか。
しかしこの方法だと、回転角に加えて上下左右なども入力できるので自由度が増える。たとえばDOOMスタイルのFPSで重要な「すり足」だって、これで入力できる可能性がある。

デメリットは「子供にわかりづらいかもしれない」ということだ。
私は車の運転をできる人なので「ハンドルで運転」という概念があるが、子供はそうはいかない。そもそも画面に映っている「時機を背中から見る視点(背面視点)」だって形而上的というかなんと言うか。


こういうときはぜひとも息子で試してみたいところなんだが…。
そういえばマリオカートDSでは、背面視点でも理解してたな。


ヒューマンインタフェースに話を戻せば、問題はこういうところだ。
 ・安定性を重視するか
 ・カッコよさを重視するか
 ・稼動範囲を大きくとってダイナミックにするか
 ・微細なコントロールの面白さに挑戦するか
 ・年齢的なロバストネスをどこまで確保するか

いっそのこと、カメラ複数台にすればいいような気もするが、画角の問題は解決しないだろうな。
それぐらいなら、床に◎でも書いて暗に立ち位置を示したほうがスマート。
丹田法を使うなら、手綱を持たせるのもいいんだけどね、まあそれは去年NAUTILUSが「バーチャル・ベンハー」でやったしな。


さて、問題もまとまったし、
こういうときは、ひたすらひたすら組んで試してみるしかないね。

----
## 横ノリ全身入力インタフェース
AceSpeeder2のUIデザインだが、ほぼ最終系に近づいてきた。

結論から言うと、技巧に走るのを抑えて、煩雑さを棄てて、プレイヤーの年齢を含めたロバストネスを優先することにした。

スクリーン正面に立って、頭の振りで入力する。
理論的には車椅子に座っていてもプレイできるはずだ。
命名「横ノリ方式」。
ライブとかで縦ノリというのがあるが、その逆だから。
（参考にならない雑談）
http://www.violin-fiddle.com/archives/000021.html
ちなみにAS2の挿入曲はテクノ・ハウス系が多いので、ノリのよいフランス娘が踊りながら遊んでくれるといいな(希望的観測)。


![image025AS.jpg](/assets/2006/image025AS.jpg)


RoboGamerで開発した連続フレーム差分による動物体認識を使うという手もあったのだが「野生の勘」で使わないことにした。
というよりGPUVisionをフルGPUで動画像認識させる改造をすると、バージョンが一気に0.98から3.0に上がってしまいそうなぐらい変わってしまい、また公開(しないかもしれないけど)が遅れてしまうだろうから。
技巧に走らない、といいながらそんなことをやっていては時間がいくらあっても足りないので、これは今度の機会にする。というか、力技で動画像認識しなくても、いろんな方法があるわけで。

そんなこんなで、バージョンは2.xとして、木村君が片っ端からクラス化したあたりを咀嚼しながら、新しいクラスとして「頭上カメラ人体認識」を作ることにした。

もとから「ファンタスティックファントムスリッパ」「ラビリンスウォーカー」「タンジブルプレイルーム」と続いている床面インタラクションシリーズで、この手のカメラ位置はやってみたいと思っていたのでいい機会だ。

カラースペース変換とかエッジ抽出フィルタとか、基準画像差分フィルタを昔自分が書いたソースを基に使ってみるが、いまいち決め手に欠ける。
そこそこ動くのだけど、ロバストネスがイマイチ。
室内の光の状態が少しでも変わると、アルゴリズムの前提が崩れる。
もちろんカメラのオートは切っているし、シャッタースピードなどもかなり吟味しているが、展示会場の光源環境は、人が沢山来たりするとすぐに変化する。LVだけなら、半暗状態に保って、背景に板ぐらい置けるかもしれないけど、他でも展示するかもしれないからなあ。


![scrennshot0.jpg](/assets/2006/scrennshot0.jpg)


こういうときは、制約条件から逆に導いたほうが早かったりする。

 ・カメラは動かない、動かさない
 ・背景は人が多く通るので、カメラは頭上におくほうがよい
 ・立ち位置はテープなどで指示可能
 ・足の動きは使わない
 ・人間の上半身左右の動きは1m程度
 ・頭より足が上になる人はいない
 ・基準画像を用意してもよい
 ・周囲が明るかったり暗かったりしても動く

という感じで基準画像差分を使って、足と頭を別々に認識できるシェーダーを書いてみた。


![scrennshot1.jpg](/assets/2006/scrennshot1.jpg)


詳細は変わるかもしれないから、いまは解説しませんが。

とりあえずかなりイメージに近い反応をするようになってきた。
ただ幾つか弱点があって、直接光源と影に弱い。
顔から頭にかけてを検出するために、ある程度の明るさが必要なのだけど、プロジェクタの灯だとちょっと色的にも明るさ的にも不安定なので、スポットを炊いてみたんだけど、これが大失敗。
顔のコントラストは出るようになったんだけど、くっきりと自分の影が背景に乗ってしまった。
まあ、影は自分の動きに追従しているから実はそれほど困った問題ではないのだけど、どうやって消そうかな、マスクか、しきい値か、エッジフィルタの類か、あとは…。


久々に家に帰る途中、この一連の開発が論文のネタにならないか思案していた。既存のPCゲームを大きく改造しないで、全身型UIを実装するあたりとか、LVの会場を使って、大量のデータを取って適応型の認識アルゴリズムをつくって検証するというあたりでいけそうな感じがする。


ところで明日はB.D.フェスティバルがあるらしい。
http://www.bdlaval.org/
Laval Virtualと会場が一緒なので、下見がてら行ってくる予定。
----

## フランスの暗いニュース数連発

書こう書こうと思っていた暗いニュースも、まとめて書けば明るくなるかもしれない。

> ■仏の「フォアグラ祭り」延期　鳥インフルエンザの影響
http://www.asahi.com/international/update/0309/012.html

まあフォアグラという食品の存在自体が健康を害する恐れがある上に、生命の尊厳がアレなんですが、残念なことです。
日本で鳥インフルエンザが流行ったときと違って、生卵や鶏肉のほかに、フォアグラの消費も影響が出てるとTVでやってました。特にこの手の料理が好きなお年寄り。
ちなみに、鳥インフルエンザは生卵やフォアグラを媒介にして移るわけではなくて、生きた鳥類と大量死の放置が問題なので「大丈夫ですよ」ともTVで言ってました。
南仏カマルグでは野鳥の大量死などを監視しているそうです。もちろんマイエンヌでもやってますね。

> ■＜鳥インフルエンザ＞フランスで捨てネコ急増
http://headlines.yahoo.co.jp/hl?a=20060310-00000021-mai-int

この毎日新聞パリ駐在の福井さんっていつもこういう話を拾ってくるな。でもTV（France3）でもやってたらしい。

> ■＜立てこもり＞元教師の男が投降、人質解放　フランスの高校
http://headlines.yahoo.co.jp/hl?a=20060310-00000025-mai-int

学校に立てこもるだけなら、私も立て篭もってますけどね。
そういや自分の高校時代の先生も、自己中で学生巻き込むタイプが多かったなあ、とか回想。
今にして思えば、高校の先生というのはそれほど人格者じゃないという気がする。
知人にフランスの高校の先生がいるけど、あの人も変な人だったなあ。
英国人とのクォーターの英語の先生で、発音はフォンナグレ、授業は好き勝手で、自由主義者。職場でのコミュニケーションがイマイチだよな、と思ってたら、ある日突然解雇された！とSMSが入った。ふうう。
それにしても解雇されたのが原因で学生を人質に取ったら、本末転倒だよな。

> ■フランス全土で学生デモ　首相の支持率急落

http://www.asahi.com/international/update/0308/004.html

> ■ソルボンヌ占拠学生排除　仏機動隊、１３人負傷

http://headlines.yahoo.co.jp/hl?a=20060311-00000137-kyodo-int

> ■雇用促進法反対で大学占拠　仏当局、学生を排除

http://headlines.yahoo.co.jp/hl?a=20060312-00000009-san-int

一連の話題になっているCPEだけど、これは賛否両論というより、ちょっと先が読めない政策だよな、本当に雇用対策になるのか、とか、ドピルパン首相(ちなみに正確にはDominique de Villepin)がこだわりすぎ、なんて話もある。日本でも小泉首相が郵政改革に執拗にこだわってたしな、なんか政治化視点では似ている気もする。
しかし市民・学生視点では日仏では明らかに違う。日本では選挙はお祭りだけど、フランスではデモがお祭りだ。
日本でも国会議事堂取り囲んだりすればいいのに、といつも思うんだが。

まあでも、外国人の私としてはデモやストはうんざりだ。
週35時間しか働かないくせに、主張するなよと、こっそり思う。
幸いなことに身近に、その手の労働者がいないので、直接衝突することはないのだが、今回の騒動は学生が主体。
さすがにラバル市内では大規模なデモなどはめったに見られないが、隣のレンヌは大学都市なので、大学の閉鎖やデモ行進などが相次いでいる。

大学関係者としては、他人事ではない。
実際この時期は、スキー休みが終わり、スタージュ(職業適性研修)が始まる時期なので、無事、将来の就職先であるスタージュ先で働き始めた学生と、デモ行進に並んでいる学生では立場は雲泥の差ではないだろうか。
考えてみればCPEで首を切られるのは、真面目に働かない若い学生だ。実力主義を導入されると困るのはそういうタイプ。

困ったことに、研究室にも一人だけそういうタイプがいて、
いまさら「スタージュ先紹介してくれませんか？」とメールを送ってきた。
個人的にはこの学生を助ける気はないんだけどなあ…。

## 追記(2020-07-26) その後の完成形

<iframe width="560" height="315" src="https://www.youtube.com/embed/N4WtupBoRMI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>


<iframe width="560" height="315" src="https://www.youtube.com/embed/OXQBMFENQFU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

